	<html>
	<head>
	    <script type="text/javascript" src="vis.min.js"></script>
	    <script type="text/javascript" src="jquery.min.js"></script>
	    <link href="vis.min.css" rel="stylesheet" type="text/css"/>
	
	    <style type="text/css">
	        #container {
	            display: block;
	        }
	        #mynetwork {
	            width: 1200px;
	            height: 400px;
	            border: 1px solid lightgray;
	            display: block;
	            margin: 32px;
	        }
	        #list-container {
	            vertical-align: top;
	            padding: 32px;
	        }
	        
			        
			       fieldset { border:1px; solid green; position:relative;}
		
		           legend {
		           padding: 0.2em 0.5em;
		           border:1px solid green;
		           color:green;
		           font-size:90%;
		           text-align:right;
		           }
		           
		           #result{
					   
					   position:relative;
					   top:50;
					   left:50;
					   right:50;
					   }
	        
	    </style>
	</head>
	<body>
	<form >
	    <select id="title">
			  <option value="Realization of Web-based simulation services">Realization of Web-based simulation services</option>
			  <option value="Collaborative simulation and scientific big data analysis: Illustration for sustainability in natural hazards management and chemical process engineering">Collaborative simulation and scientific big data analysis: Illustration for sustainability in natural hazards management and chemical process engineering</option>
			  <option value="Sustainable interoperability on space mission feasibility studies">Sustainable interoperability on space mission feasibility studies</option>
			  <option value="Compositional verification of asynchronous concurrent systems using CADP">Compositional verification of asynchronous concurrent systems using CADP</option>
			  <option value="Advanced optimal tolerance design of mechanical assemblies with interrelated dimension chains and process precision limits">"Advanced optimal tolerance design of mechanical assemblies with interrelated dimension chains and process precision limits"</option>
			  <option value="Collaborative business and data privacy: Toward a cyber-control">"Collaborative business and data privacy: Toward a cyber-control"</option>
			  <option value="Intelligent monitoring and diagnosis of manufacturing processes using an integrated approach of KBANN and GA">"Intelligent monitoring and diagnosis of manufacturing processes using an integrated approach of KBANN and GA"</option>
              <option value="An integrated Petri net and GA based approach for scheduling of hybrid plants">An integrated Petri net and GA based approach for scheduling of hybrid plants</option>
              <option value="Pre-processing methodology for optimizing stereolithography apparatus build performance"> Pre-processing methodology for optimizing stereolithography apparatus build performance</option>

			</select> 
	
	    <input type="number" id="layer" value="1"><br>
	
	    <button type = "button" id = "sub">SUBMIT QUERY</button>
	    </form>
	<button type = "button" id = "hier">Hierarchical Layout</button>
	<button type = "button" id = "graph">Graph Layout</button>
	<table id = "container">
	<tr>
	<td><div id="mynetwork"></div></td>
	<td id="list-container">
	    <ul>
	    
	    </ul>
	</td>
	</tr>
	</table>
	<p id="eventSpan"></p>
	<p id="edgeSpan"></p>
	
	<script type="text/javascript">  
	var id=1;
	
	    
	$('#hier').click(function() {
	         var options = {
	                interaction:{hover:true},
	                layout: {
	                    randomSeed: undefined,
	                    improvedLayout:false,
	                    hierarchical: {
	                        enabled:true,
	                        levelSeparation: 150,
	                        direction: 'UD',   // UD, DU, LR, RL
	                        sortMethod: 'hubsize' // hubsize, directed
	                    }
	                }
	         }
	    network.setOptions(options);    
	});
	    
	$('#graph').click(function() {
	         var options = {
	                interaction:{hover:true},
	                layout: {
	                    randomSeed: undefined,
	                    improvedLayout:true,
	                    hierarchical: {
	                        enabled:false
	                    }
	                }
	         }
	    network.setOptions(options);    
	});
	    
	$('#sub').click(function() {
		id=1;
	    var layer = document.getElementById("layer").value;
	    var title = document.getElementById("title").value;
	    newNodes = [];
	    newNodesNextLevel = [];
	    nodes = [];
	    edges = [];
	    edgesMap = {};
	    nodesMap = {};
	    edgeId = 0;
	    
		newNodesNextLevel.push(title);
	    
	    for(var i = 0; i < layer;i++){
		     
		    newNodes = newNodesNextLevel.slice();
		    newNodesNextLevel = [];
		    
		    while(newNodes.length > 0){
		    //for(var j = 0; j < len; j++){
				//var d = newNodes[j];
				
			    var d = newNodes[0];
			    newNodes.splice(0,1);
			   
			    $.ajax(
				{
				    method:'post',
				    url:'ricerca.php',
				    data:
				    {
					'title': d
				    },
				    success: function(data){
					    generate_graph(data, d );
					    extractKeywordsAndTopics(data);
				    },
				     async: false
				});
		    }
	    }
	    
	    drawGraph();
	    });
	    
	   
	    
	    function generate_graph(data, title) {
			
		
	    var parsedData = JSON.parse(data);
		//adding root if nodes is empty
		if(nodes.length == 0){
			nodes.push(JSON.parse('{"id":"' + title +'", "label": "s", "title":"' + title +'"}'));
		}
		for(var key in parsedData.articles){
			
			var existFlag = false;
			var existEdgeFlag = false;
			var article = parsedData.articles[key];
			var actualId = article.id;
			var actualTitle = article.title;
			
			var actualEdge = {};
			var edgeValue = 0;
			actualEdge["sourceTitle"] = title;
			actualEdge["title"] = actualTitle;
			actualEdge["keyword"] = article.keyword;
			actualEdge["topic"] = article.topic;
			
			for (var oldEdge in edges){
				if(edges[oldEdge].from == actualTitle || edges[oldEdge].to == actualTitle) {
					existEdgeFlag = true;
					break;
				}
			}
			if(nodes.indexOf(actualTitle) < 0){
			    actualTitle = actualTitle.replace('"', ''); 
				actualTitle = actualTitle.replace('"', ''); 
				
				var nodeToPush = JSON.parse('{"id":"' + actualTitle +'", "label":"' + id + '", "title":"' + actualTitle + '"}');
				id++;
				for (var oldNode in nodes) {
						if(nodes[oldNode].title == actualTitle) {
							existFlag = true;
							break;
						}
				}
				if(!existFlag) {
					nodes.push(nodeToPush);
				    newNodesNextLevel.push(actualTitle);	
					existFlag = false;
				}
			}
			
				
			
			for(var currentValue in article.keyword) {
				edgeValue +=parseFloat(article.keyword[currentValue]);
			}
			if(!existEdgeFlag){
				edges.push(JSON.parse('{"from":"' + title + '", "to": "' + actualTitle + '", "id": ' + edgeId + ', "value":' + edgeValue + '}'));
				edgesMap[edgeId] = actualEdge;
				edgeId++
			}
		}
	    }
	
	    function drawGraph(){
			
	        var data = {
	            nodes: nodes,
	            edges: edges
	        }
	         
	        //$('#list-container ul').html('');
	        
	        /*for(var i = 0; i < data.nodes.length; i++) {
	            $('#list-container ul').append('<li> id: ' + data.nodes[i].label + ' title: ' + data.nodes[i].id);
	        }*/
	        
	        var custom_options = {
	            interaction:{hover:true},
	            layout: {
	                randomSeed: undefined,
	                improvedLayout:true,
	            },
	            nodes:{
	                shape:'circle'/*,
	                scaling: {
	                    min: 30,
	                    max: 30,
	                    label: {
	                        enabled: true,
	                        min: 10,
	                        max: 30,
	                        maxVisible: 10,
	                        drawThreshold: 5,
	                    },
	                    customScalingFunction: function (min,max,total,value) {
	                        if (max === min) {
	                            return 0.5;
	                        }
	                        else {
	                            var scale = 1 / (max - min);
	                            return Math.max(0,(value - min)*scale);
	                        }
	                    }
	                },*/
	            }
	        }   
	        
	        var container = document.getElementById('mynetwork');
	        
	        // create a network
	        network = new vis.Network(container, data, custom_options);
	        
	        network.on("hoverNode", function (params) {
				
	            params.event = "[original event]";
	            
	            document.getElementById('eventSpan').innerHTML = '<h2>Node information:</h2>'+params["node"];
	        });
	        
	        network.on("hoverEdge", function (params) {
			    params.event = "[original event]";
			    var informationArticle="<h2>Node information:</h2>";
			    informationArticle+=edgesMap[params["edge"]].title+"<br>";
				informationArticle+="<h2>Edge information:</h2>";
	            var somma=0;
	           informationArticle+="<h3>Keywords</h3>"
	           for(var indice in edgesMap[params["edge"]].keyword){
				    somma+=parseFloat(edgesMap[params["edge"]].keyword[indice]);
					informationArticle+=indice+" --- "+edgesMap[params["edge"]].keyword[indice]+"<br>";
				}
				
				if(edgesMap[params["edge"]].topic.length>0){
				informationArticle+="<h3>Topic</h3>"
				for(var indice2 in edgesMap[params["edge"]].topic){
				    somma+=1;
					informationArticle+=edgesMap[params["edge"]].topic[indice2]+"<br>";
					}
				}
				informationArticle+="<br><br>Somma relevance= "+somma;	
	            document.getElementById('eventSpan').innerHTML =informationArticle;
	        });
	        
	        network.on("click", function(params) {
	            console.log("Click: " + JSON.stringify(params, null, 4));
	        });
	    }
	    
	    function extractKeywordsAndTopics(data){
			  var obj = JSON.parse(data);
			  var topics=new Array();
			  var keywords = new Array();
			  var articles=new Array();
			                
			                
			  topics=obj.topics;
			  keywords=obj.keywords;
			  articles=obj.articles;
			  var toStamp="";
			
			           
			            if(typeof topics !== "undefined"){
			                toStamp+="<fieldset><legend>Topics</legend><br>";
			            
			            for(var indice in topics){
			               
			                toStamp+="<input type='checkbox' name='"+topics[indice]+"' value='"+topics[indice]+"' /"+">"+topics[indice]+"<br>"; 
			
			                }
			               toStamp+="</fieldset> <br>";
			               }
			                
			
			             toStamp+="<fieldset><legend>Keywords</legend><br>"; 
			
			            for(var indice in keywords){
			               
			                toStamp+="<input type='checkbox' name='"+keywords[indice]+"' value='"+keywords[indice]+"' /"+">"+keywords[indice]+"<br>"; 
			
			               }
			               toStamp+="</fieldset> <br><button  onclick='CercaRistretta()'>Restringi Ricerca</button>";
			                document.getElementById("result").innerHTML = toStamp;  
			           
			    }
			
	</script>
	
	<span id="result"></span>
	</body>
	</html>
	
