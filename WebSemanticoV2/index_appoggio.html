	<html>
	<head>
	    <script type="text/javascript" src="vis.min.js"></script>
	    <script type="text/javascript" src="jquery.min.js"></script>
	    <link href="vis.min.css" rel="stylesheet" type="text/css"/>
	
	    <style type="text/css">
	        #container {
	            display: block;
	        }
	        #mynetwork {
				
	            width: 400px;
	            height: 400px;
	            border: 1px solid lightgray;
	            display: block;
	            margin: 32px;
	        }
	        #list-container {
	            vertical-align: top;
	            padding: 32px;
	        }
	        
			        
			       fieldset { border:1px; solid green; position:relative;}
		
		           legend {
		           padding: 0.2em 0.5em;
		           border:1px solid green;
		           color:green;
		           font-size:90%;
		           text-align:right;
		           }
		           #info{
					   position:relative;
					   right:0;
					   top:50;
					   }
		           #result{
					   
					   position:relative;
					   top:50;
					   left:50;
					   right:50;
					   }
	        
	    </style>
	</head>
	<body>
	<form >
	    <select id="title">
			  <option value="Realization of Web-based simulation services">Realization of Web-based simulation services</option>
			  <option value="Collaborative simulation and scientific big data analysis: Illustration for sustainability in natural hazards management and chemical process engineering">Collaborative simulation and scientific big data analysis: Illustration for sustainability in natural hazards management and chemical process engineering</option>
			  <option value="Sustainable interoperability on space mission feasibility studies">Sustainable interoperability on space mission feasibility studies</option>
			  <option value="Compositional verification of asynchronous concurrent systems using CADP">Compositional verification of asynchronous concurrent systems using CADP</option>
			  <option value="Transposition of Large Tabular Data Structures with Applications to Physical Database Organization">"Transposition of Large Tabular Data Structures with Applications to Physical Database Organization"</option>
			  <option value="Collaborative business and data privacy: Toward a cyber-control">"Collaborative business and data privacy: Toward a cyber-control"</option>
			  <option value="Intelligent monitoring and diagnosis of manufacturing processes using an integrated approach of KBANN and GA">"Intelligent monitoring and diagnosis of manufacturing processes using an integrated approach of KBANN and GA"</option>
              <option value="An integrated Petri net and GA based approach for scheduling of hybrid plants">An integrated Petri net and GA based approach for scheduling of hybrid plants</option>
              <option value="Pre-processing methodology for optimizing stereolithography apparatus build performance"> Pre-processing methodology for optimizing stereolithography apparatus build performance</option>

			</select> 
	
	    <input type="number" id="layer" value="1"><br>
	
	    <button type = "button" id = "sub">SUBMIT QUERY</button>
	    </form>
	<button type = "button" id = "hier">Hierarchical Layout</button>
	<button type = "button" id = "graph">Graph Layout</button>
	<table id = "container">
	<tr>
	<td><div id="mynetwork"></div></td>
	<td id="list-container">
	    <ul>
	    
	    </ul>
	</td>
	</tr>
	</table>
	<p id="info">
	<p id="eventSpan"></p>
	<p id="edgeSpan"></p>
	</p>
	<script type="text/javascript">  
	var id=1;
	var topicsCheckbox=new Array();
	var keywordsCheckbox=new Array();
	var articlesCheckbox=new Array();
	    
	$('#hier').click(function() {
	         var options = {
	                interaction:{hover:true},
	                layout: {
	                    randomSeed: undefined,
	                    improvedLayout:false,
	                    hierarchical: {
	                        enabled:true,
	                        levelSeparation: 150,
	                        direction: 'UD',   // UD, DU, LR, RL
	                        sortMethod: 'hubsize' // hubsize, directed
	                    }
	                }
	         }
	    network.setOptions(options);    
	});
	    
	$('#graph').click(function() {
	         var options = {
	                interaction:{hover:true},
	                layout: {
	                    randomSeed: undefined,
	                    improvedLayout:true,
	                    hierarchical: {
	                        enabled:false
	                    }
	                }
	         }
	    network.setOptions(options);    
	});
	    
	$('#sub').click(function() {
		id=1;
	    var layer = document.getElementById("layer").value;
	    var title = document.getElementById("title").value;
	    newNodes = [];
	    newNodesNextLevel = [];
	    nodes = [];
	    edges = [];
	    edgesMap = {};
	    nodesMap = {};
	    edgeId = 0;
	    
	    
	    
		newNodesNextLevel.push(title);
	    
	    for(var i = 0; i < layer;i++){
		     
		    newNodes = newNodesNextLevel.slice();
		    newNodesNextLevel = [];
		    
		    while(newNodes.length > 0){
		    //for(var j = 0; j < len; j++){
				//var d = newNodes[j];
				
			    var d = newNodes[0];
			    newNodes.splice(0,1);
			   
			    $.ajax(
				{
				    method:'post',
				    url:'ricerca.php',
				    data:
				    {
					'title': d
				    },
				    success: function(data){
					    generate_graph(data, d );
					    extractKeywordsAndTopics(data);
				    },
				     async: false
				});
		    }
	    }
	    
	    drawGraph(nodes,edges);
	    
	    });
	    
	   
	    
	    function generate_graph(data, title) {
		
		try {
            var parsedData = JSON.parse(data);
            }
        catch(err) {
             console.log(data);
             }
	    
		//adding root if nodes is empty
		if(nodes.length == 0){
			nodes.push(JSON.parse('{"id":"' + title +'", "label": "s", "title":"Sorgente"}'));
		}
		for(var key in parsedData.articles){
			
			var existFlag = false;
			var existEdgeFlag = false;
			var article = parsedData.articles[key];
			var actualId = article.id;
			var actualTitle = article.title;
			var relation="<b>Topics:</b><BR>";
			var actualEdge = {};
			var edgeValue = 0;
			actualEdge["sourceTitle"] = title;
			actualEdge["title"] = actualTitle;
			actualEdge["keyword"] = article.keyword;
			actualEdge["topic"] = article.topic;
			
			for(var key2 in article.topic ){
				relation+=article.topic[key2]+"<BR>";
			}
			
			relation += "<b>Keywords:</b><BR>";
			
			for(var key2 in article.keyword ){
				relation+=key2+"<BR>";
			}
			
			for (var oldEdge in edges){
				if(edges[oldEdge].from == actualTitle || edges[oldEdge].to == actualTitle) {
					existEdgeFlag = true;
					break;
				}
			}
			if(nodes.indexOf(actualTitle) < 0){
			    actualTitle = actualTitle.replace('"', ''); 
				actualTitle = actualTitle.replace('"', ''); 
				
				var nodeToPush = JSON.parse('{"id":"' + actualTitle +'", "label":"' + id + '"}');
				id++;
				for (var oldNode in nodes) {
						if(nodes[oldNode].id == actualTitle) {
							existFlag = true;
							break;
						}
				}
				if(!existFlag) {
					nodes.push(nodeToPush);
				    newNodesNextLevel.push(actualTitle);	
					existFlag = false;
				}
			}
			
				
			
			for(var currentValue in article.keyword) {
				edgeValue +=parseFloat(article.keyword[currentValue]);
			}
			if(!existEdgeFlag){
				edges.push(JSON.parse('{"from":"' + title + '", "to": "' + actualTitle + '", "id": ' + edgeId + ', "value":' + edgeValue + ', "title":"' + relation + '"}'));
				edgesMap[edgeId] = actualEdge;
				edgeId++
			}
		}
	    }
	
	    function drawGraph(node,edge){
			
	        var data = {
	            nodes: node,
	            edges: edge
	        }
	    
	         
	        //$('#list-container ul').html('');
	        
	        /*for(var i = 0; i < data.nodes.length; i++) {
	            $('#list-container ul').append('<li> id: ' + data.nodes[i].label + ' title: ' + data.nodes[i].id);
	        }*/
	        
	        var custom_options = {
	            interaction:{hover:true},
	            layout: {
	                randomSeed: undefined,
	                improvedLayout:true,
	            },
	            nodes:{
	                shape:'circle'/*,
	                scaling: {
	                    min: 30,
	                    max: 30,
	                    label: {
	                        enabled: true,
	                        min: 10,
	                        max: 30,
	                        maxVisible: 10,
	                        drawThreshold: 5,
	                    },
	                    customScalingFunction: function (min,max,total,value) {
	                        if (max === min) {
	                            return 0.5;
	                        }
	                        else {
	                            var scale = 1 / (max - min);
	                            return Math.max(0,(value - min)*scale);
	                        }
	                    }
	                },*/
	            }
	        }   
	        
	        var container = document.getElementById('mynetwork');
	        
	        // create a network
	        network = new vis.Network(container, data, custom_options);
	        
	        
	        
	        
	        
	        
	        
	        network.on('doubleClick',function (params){
				 
				 params.event = "[original click event]";
				 q=params.nodes;
				 
				  $.ajax(
				{
				    method:'post',
				    url:'urlArticolo.php',
				    data:
				    {
					'title': q
				    },
				    success: function(data){
					   
					   var parseUrl=JSON.parse(data);
					   
					   //window.location.href = parseUrl;
					   
					   alert(parseUrl);
							
				    }, async: false
				   
				});
				
				 
				});
						
	        network.on("hoverNode", function (params) {
				
	            params.event = "[original event]";
	            t=params["node"];
	            var toPrint='<h2>Node information</h2><b>TITLE: </b>'+params["node"]+"<br>";
	            
	           
	             $.ajax(
				{
				    method:'post',
				    url:'datiArticolo.php',
				    data:
				    {
					'title': t
				    },
				    success: function(data){
					    var parsedInfo = JSON.parse(data);
					    toPrint+="<b>JOURNAL: </b>";
					    for(var key in parsedInfo.journal){
							 toPrint+=parsedInfo.journal[key];
							}
						toPrint+="<br><b>AUTHORS: </b>";
					    for(var key in parsedInfo.author){
							 if(key==parsedInfo.author.length-1)
							  toPrint+=parsedInfo.author[key];
							  else
							   toPrint+=parsedInfo.author[key]+", ";
							}
						toPrint+="<br><b>YEAR: </b>";
					    for(var key in parsedInfo.data){
							 toPrint+=parsedInfo.data[key];
							}
						toPrint+="<br><b>KEYWORDS: </b>";
					    for(var key in parsedInfo.keyword){
							
							 if(key==parsedInfo.keyword.length-1)
							  toPrint+=parsedInfo.keyword[key];
							  else
							   toPrint+=parsedInfo.keyword[key]+", ";
							}
						toPrint+="<br><b>TOPICS: </b>";
					    for(var key in parsedInfo.topic){
							
							 if(key==parsedInfo.topic.length-1)
							  toPrint+=parsedInfo.topic[key];
							  else
							   toPrint+=parsedInfo.topic[key]+", ";
							}
						toPrint+="<br><b>URL: </b>";
						
						var url="";
						for(var key in parsedInfo.url){
							   
							   url+=parsedInfo.url[key];
							  
							}
							toPrint+='<a href='+url+'>';
							toPrint+=url;
							toPrint+="</a>";  
				    },async: false
				});
				document.getElementById('eventSpan').innerHTML = toPrint;
	        });
	        
	        network.on("hoverEdge", function (params) {
			    params.event = "[original event]";
			    var informationArticle="<h2>Edge information</h2>";
			    informationArticle+="<b>Source:</b> "+edgesMap[params["edge"]].sourceTitle+" <br><b>Dest</b>: "+edgesMap[params["edge"]].title+"<br>";
	            var somma=0;
	           for(var indice in edgesMap[params["edge"]].keyword){
				    somma+=parseFloat(edgesMap[params["edge"]].keyword[indice]);
					//informationArticle+=indice+" --- "+edgesMap[params["edge"]].keyword[indice]+"<br>";
				}
				
				if(edgesMap[params["edge"]].topic.length>0){
				for(var indice2 in edgesMap[params["edge"]].topic){
				    somma+=1;
					//informationArticle+=edgesMap[params["edge"]].topic[indice2]+"<br>";
					}
				}
				informationArticle+="<br><b>Somma relevance=</b> "+somma;	
	            document.getElementById('eventSpan').innerHTML =informationArticle;
	        });
	        
	        network.on("click", function(params) {
	            console.log("Click: " + JSON.stringify(params, null, 4));
	        });
	    }
	    
	    function extractKeywordsAndTopics(data){
			
			
			  var obj = JSON.parse(data);
			  alert(obj.topics.length);
			  if(typeof(obj.topics)!='undefined')
			    topicsCheckbox = topicsCheckbox.concat(obj.topics); 
			    
			  keywordsCheckbox=  keywordsCheckbox.concat(obj.keywords);
			  articlesCheckbox=articlesCheckbox.concat(obj.article);
			  var toStamp="";
			
			           
			            if(typeof topicsCheckbox !== "undefined"){
			                toStamp+="<fieldset><legend>Topics</legend><br>";
			            
			            for(var indice in topicsCheckbox){
			               
			                toStamp+="<input type='checkbox' class='topic' id='"+topicsCheckbox[indice]+"' value='"+topicsCheckbox[indice]+"' /"+">"+topicsCheckbox[indice]+"<br>"; 
			
			                }
			               toStamp+="</fieldset> <br>";
			               }
			                
			
			             toStamp+="<fieldset><legend>Keywords</legend><br>"; 
			
			            for(var indice in keywordsCheckbox){
			               
			                toStamp+="<input type='checkbox' class='keyword' id='"+keywordsCheckbox[indice]+"' value='"+keywordsCheckbox[indice]+"' /"+">"+keywordsCheckbox[indice]+"<br>"; 
			
			               }
			               toStamp+="</fieldset> <br><button  onclick='restringiGrafo()'>Restringi Ricerca</button><button  onclick='returnGraph()'>Grafo di partenza</button>";
			                document.getElementById("result").innerHTML = toStamp;  
			           
			    }
			    
			    function returnGraph(){
					drawGraph(nodes,edges);
					}
					
			    function restringiGrafo(){
					var  topic= document.getElementsByClassName("topic");
					var  keyword = document.getElementsByClassName("keyword");
					var  keywordChecked = new Array();
					var  topicChecked = new Array();
					var i=0;
					for(var key in keyword){
						if(typeof(keyword[key].value)!="undefined"){
						var checked=document.getElementById(keyword[key].value).checked;
						if(checked==true){
							keywordChecked[i]=keyword[key].value;
							i++;
						   }
					    }	
				    }
					i=0;
					for(var key in topic){
						if(typeof(topic[key].value)!="undefined"){
						var checked=document.getElementById(topic[key].value).checked;
						if(checked==true){
							alert(checked);
							topicChecked[i]=topic[key].value;
							i++;
						   }
					    }	
				    }
					
					var newNodes=nodes.slice();
					var newEdges=edges.slice();
					del=false;
					//alert(newEdges.length);
					if(keywordChecked.length>0){
					
					for(var key=0;key<newEdges.length;++key){ // per ogni arco
						
						var edge = edgesMap[newEdges[key].id];
						keywordEdge=edge["keyword"];
						for(var key2 in keywordEdge) // per ogni keyword dell arco vedo se c'è n'è una checked
						    for(var key3 in  keywordChecked){
								if(key2==keywordChecked[key3]){
								  del=true;
								  break;
								}
							}
							if(!del){
									newEdges.splice(key,1);
									key--;
									}
								else
								 del=false;
						}
					}
					
					
					
						
					//alert(newEdges.length);
					
					 drawGraph(newNodes,newEdges);
				}
			
	</script>
	
	<span id="result"></span>
	</body>
	</html>
	
